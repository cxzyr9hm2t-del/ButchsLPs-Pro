name: üöÄ Deploy ButchsLPs Pro

on:
  push:
      branches: [ main ]
        pull_request:
            branches: [ main ]

            jobs:
              test:
                  name: üß™ Test & Quality Check
                      runs-on: ubuntu-latest

                              steps:
                                  - name: üìÇ Checkout code
                                        uses: actions/checkout@v4

                                                  - name: üì¶ Setup Node.js
                                                        uses: actions/setup-node@v4
                                                              with:
                                                                      node-version: '18'
                                                                              cache: 'npm'

                                                                                          - name: üì• Install dependencies
                                                                                                run: npm ci
                                                                                                      
                                                                                                          - name: üîç Type checking
                                                                                                                run: npm run type-check
                                                                                                                      
                                                                                                                          - name: üéØ Lint code
                                                                                                                                run: npm run lint
                                                                                                                                      
                                                                                                                                          - name: üß™ Run tests
                                                                                                                                                run: npm run test
                                                                                                                                                      
                                                                                                                                                          - name: üìä Test coverage
                                                                                                                                                                run: npm run test:coverage
                                                                                                                                                                
                                                                                                                                                                  build:
                                                                                                                                                                      name: üèóÔ∏è Build Application
                                                                                                                                                                          runs-on: ubuntu-latest
                                                                                                                                                                              needs: test
                                                                                                                                                                                  
                                                                                                                                                                                      steps:
                                                                                                                                                                                          - name: üìÇ Checkout code
                                                                                                                                                                                                uses: actions/checkout@v4
                                                                                                                                                                                                      
                                                                                                                                                                                                          - name: üì¶ Setup Node.js
                                                                                                                                                                                                                uses: actions/setup-node@v4
                                                                                                                                                                                                                      with:
                                                                                                                                                                                                                              node-version: '18'
                                                                                                                                                                                                                                      cache: 'npm'
                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                  - name: üì• Install dependencies
                                                                                                                                                                                                                                                        run: npm ci
                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                  - name: üèóÔ∏è Build project
                                                                                                                                                                                                                                                                        run: npm run build
                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                  - name: üì§ Upload build artifacts
                                                                                                                                                                                                                                                                                        uses: actions/upload-artifact@v3
                                                                                                                                                                                                                                                                                              with:
                                                                                                                                                                                                                                                                                                      name: dist
                                                                                                                                                                                                                                                                                                              path: dist/
                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                deploy-vercel:
                                                                                                                                                                                                                                                                                                                    name: üåê Deploy to Vercel
                                                                                                                                                                                                                                                                                                                        runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                            needs: build
                                                                                                                                                                                                                                                                                                                                if: github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                        steps:
                                                                                                                                                                                                                                                                                                                                            - name: üìÇ Checkout code
                                                                                                                                                                                                                                                                                                                                                  uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                            - name: üì§ Deploy to Vercel
                                                                                                                                                                                                                                                                                                                                                                  uses: amondnet/vercel-action@v25
                                                                                                                                                                                                                                                                                                                                                                        with:
                                                                                                                                                                                                                                                                                                                                                                                vercel-token: ${{ secrets.VERCEL_TOKEN }}
                                                                                                                                                                                                                                                                                                                                                                                        vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
                                                                                                                                                                                                                                                                                                                                                                                                vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
                                                                                                                                                                                                                                                                                                                                                                                                        vercel-args: '--prod'
                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                          deploy-netlify:
                                                                                                                                                                                                                                                                                                                                                                                                              name: üì° Deploy to Netlify
                                                                                                                                                                                                                                                                                                                                                                                                                  runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                      needs: build
                                                                                                                                                                                                                                                                                                                                                                                                                          if: github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                  steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: üìÇ Checkout code
                                                                                                                                                                                                                                                                                                                                                                                                                                            uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: üì¶ Setup Node.js
                                                                                                                                                                                                                                                                                                                                                                                                                                                            uses: actions/setup-node@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          node-version: '18'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  cache: 'npm'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: üì• Install dependencies
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    run: npm ci
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: üèóÔ∏è Build project
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    run: npm run build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: üì§ Deploy to Netlify
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    uses: netlify/actions/cli@master
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  args: deploy --prod --dir=dist
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        env:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          deploy-railway:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              name: üöÇ Deploy to Railway
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      needs: build
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if: github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: üìÇ Checkout code
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      - name: üöÇ Deploy to Railway
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            uses: railwayapp/gh-action@v0.1.1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            lighthouse:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                name: üîç Lighthouse Audit
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        needs: deploy-vercel
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if: github.ref == 'refs/heads/main'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: üìÇ Checkout code
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        - name: üîç Run Lighthouse
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              uses: treosh/lighthouse-ci-action@v9
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            urls: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      https://butchslps-pro.vercel.app
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              uploadArtifacts: true
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      temporaryPublicStorage: true
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        security:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            name: üîí Security Audit
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                runs-on: ubuntu-latest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        steps:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: üìÇ Checkout code
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  uses: actions/checkout@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: üì¶ Setup Node.js
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  uses: actions/setup-node@v4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        with:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                node-version: '18'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: üîç Security audit
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  run: npm audit --audit-level=high
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            - name: üõ°Ô∏è CodeQL Analysis
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  uses: github/codeql-action/analyze@v2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
